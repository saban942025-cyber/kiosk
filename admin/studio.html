<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sika Studio - Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Heebo', sans-serif; background: #111; color: white; padding: 40px; }
        .card { background: #222; border: 1px solid #333; padding: 25px; border-radius: 20px; margin-bottom: 20px; }
        .input-dark { background: #000; border: 1px solid #444; color: white; padding: 12px; border-radius: 10px; width: 100%; display: block; margin-top: 5px; }
        .label { font-size: 12px; color: #888; font-weight: bold; text-transform: uppercase; margin-top: 15px; display: block; }
    </style>
</head>
<body class="max-w-4xl mx-auto">

    <header class="flex justify-between items-center mb-10 border-b border-gray-800 pb-6">
        <div>
            <h1 class="text-4xl font-black text-[#FFC500]">Sika Studio ğŸ›ï¸</h1>
            <p class="text-gray-400">××—×•×‘×¨ ×œ×¤×¨×•×™×§×˜: <span class="text-green-400 font-bold">kiosk-saban94 ğŸ”¥</span></p>
        </div>
        <a href="../index.html" target="_blank" class="bg-white text-black px-6 py-3 rounded-full font-bold hover:bg-gray-200">×¤×ª×— ×§×™×•×¡×§ >></a>
    </header>

    <div class="grid grid-cols-2 gap-8">
        <div class="card border-yellow-600/50 col-span-2">
            <h2 class="text-xl font-bold mb-6 text-[#FFC500] flex items-center gap-2"><i data-lucide="cloud-lightning"></i> ×©×™×“×•×¨ ××•×¦×¨ ×œ×§×™×•×¡×§</h2>
            <div class="flex gap-8">
                <div class="w-1/3">
                    <label class="label">×ª××•× ×ª ××•×¦×¨ (URL)</label>
                    <input id="pImg" class="input-dark" placeholder="https://..." onchange="document.getElementById('preview').src = this.value">
                    <img id="preview" src="https://placehold.co/400?text=Preview" class="w-full h-40 object-contain mt-4 bg-white rounded-lg">
                </div>
                <div class="w-2/3">
                    <label class="label">×©× ×”××•×¦×¨</label>
                    <input id="pName" class="input-dark" placeholder="×œ××©×œ: Sika Ceram 255">
                    
                    <div class="grid grid-cols-2 gap-4 mt-2">
                        <div>
                            <label class="label">××•×ª×’</label>
                            <select id="pBrand" class="input-dark">
                                <option>SIKA</option>
                                <option>THERMOKIR</option>
                                <option>MISTER FIX</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">×§×˜×’×•×¨×™×”</label>
                            <select id="pCat" class="input-dark">
                                <option value="sealing">××™×˜×•×</option>
                                <option value="glues">×“×‘×§×™×</option>
                                <option value="flooring">×¨×™×¦×•×£</option>
                            </select>
                        </div>
                    </div>
                    
                    <label class="label">×ª×™××•×¨ ×©×™×•×•×§×™</label>
                    <textarea id="pDesc" class="input-dark h-24"></textarea>
                    
                    <button id="btnSave" class="w-full bg-[#E3000F] text-white py-3 rounded-xl font-bold mt-4 hover:bg-red-600 shadow-[0_0_20px_rgba(227,0,15,0.4)] transition">
                        ×©×“×¨ ××•×¦×¨ ×œ×¢× ×Ÿ ğŸš€
                    </button>
                </div>
            </div>
        </div>

        <div class="card col-span-2">
            <h2 class="text-xl font-bold mb-4">××•×¦×¨×™× ×‘××•×•×™×¨ (<span id="count">0</span>)</h2>
            <div id="productsList" class="grid grid-cols-4 gap-4 max-h-96 overflow-y-auto pr-2">
                <div class="col-span-4 text-center text-gray-500 mt-4">×˜×•×¢×Ÿ...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ğŸ”¥ ×”×§×•× ×¤×™×’×•×¨×¦×™×” ×©×œ×š ğŸ”¥
        const firebaseConfig = {
            apiKey: "AIzaSyDTdmqaOHerwTOpfe9qKSCP895CcIErOwo",
            authDomain: "kiosk-saban94.firebaseapp.com",
            projectId: "kiosk-saban94",
            storageBucket: "kiosk-saban94.firebasestorage.app",
            messagingSenderId: "305877295234",
            appId: "1:305877295234:web:388472509b86a7052a949b",
            measurementId: "G-1LFT3538QN"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 1. ×©××™×¨×ª ××•×¦×¨ ×œ×¢× ×Ÿ
        document.getElementById('btnSave').addEventListener('click', async () => {
            const btn = document.getElementById('btnSave');
            const originalText = btn.innerText;
            btn.innerText = "××©×“×¨...";
            btn.disabled = true;
            
            try {
                await addDoc(collection(db, "products"), {
                    name: document.getElementById('pName').value,
                    brand: document.getElementById('pBrand').value,
                    category: document.getElementById('pCat').value,
                    marketingDesc: document.getElementById('pDesc').value,
                    image: document.getElementById('pImg').value,
                    createdAt: Date.now()
                });
                
                alert("×”××•×¦×¨ ×‘××•×•×™×¨! âœ…");
                // × ×§×” ×©×“×•×ª
                document.getElementById('pName').value = "";
                document.getElementById('pDesc').value = "";
                document.getElementById('pImg').value = "";
                document.getElementById('preview').src = "https://placehold.co/400?text=Preview";
                
            } catch (e) {
                console.error("Error adding document: ", e);
                alert("×©×’×™××” ×‘×©×™×“×•×¨: " + e.message);
            }
            btn.innerText = originalText;
            btn.disabled = false;
        });

        // 2. ×”××–× ×” ×œ×¨×©×™××” ×§×™×™××ª (×•××—×™×§×”)
        onSnapshot(collection(db, "products"), (snapshot) => {
            const list = document.getElementById('productsList');
            document.getElementById('count').innerText = snapshot.size;
            
            list.innerHTML = "";
            
            if(snapshot.size === 0) {
                list.innerHTML = '<div class="col-span-4 text-center text-gray-500">×”×××’×¨ ×¨×™×§.</div>';
                return;
            }

            snapshot.forEach((docSnap) => {
                const p = docSnap.data();
                const id = docSnap.id;
                
                const div = document.createElement('div');
                div.className = "bg-black p-3 rounded-lg border border-gray-800 relative group";
                div.innerHTML = `
                    <img src="${p.image}" class="h-20 w-full object-contain mb-2 bg-white rounded" onerror="this.src='https://placehold.co/400'">
                    <div class="font-bold text-sm truncate" title="${p.name}">${p.name}</div>
                    <button class="absolute top-2 right-2 bg-red-600 p-1 rounded text-white opacity-0 group-hover:opacity-100 transition"><i data-lucide="trash" size="14"></i></button>
                `;
                
                // ×”×•×¡×¤×ª ××™×¨×•×¢ ××—×™×§×”
                div.querySelector('button').addEventListener('click', async () => {
                    if(confirm("×œ××—×•×§ ××ª " + p.name + " ××”×¢× ×Ÿ?")) {
                        await deleteDoc(doc(db, "products", id));
                    }
                });
                
                list.appendChild(div);
            });
            lucide.createIcons();
        });

    </script>
</body>
</html>
