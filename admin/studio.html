<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sika-Ai Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Heebo', sans-serif; background: #f3f4f6; padding: 20px; }
        .input-std { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; margin-top: 5px; background: white; }
        
        /* Kiosk Card Preview Style */
        .preview-card {
            background: white; border-radius: 20px; overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1); width: 320px; height: 480px;
            margin: 0 auto; display: flex; flex-direction: column; border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body class="flex gap-8 max-w-7xl mx-auto h-[95vh]">

    <div class="w-1/2 flex flex-col gap-4 overflow-y-auto pr-2">
        <header class="flex justify-between items-center bg-white p-6 rounded-2xl shadow-sm">
            <div>
                <h1 class="text-3xl font-black text-[#E3000F]">Sika-Ai Studio</h1>
                <p class="text-gray-400 text-sm">××¢×¨×›×ª × ×™×”×•×œ ×—×›××”</p>
            </div>
            <a href="../index.html" target="_blank" class="bg-black text-white px-4 py-2 rounded-lg text-sm font-bold">×œ×§×™×•×¡×§</a>
        </header>

        <div class="bg-white p-6 rounded-2xl shadow-sm space-y-4">
            <h2 class="font-bold flex items-center gap-2"><i data-lucide="wand-2" class="text-purple-500"></i> ××—×•×œ×œ AI</h2>
            <div class="flex gap-2">
                <input id="aiInput" class="input-std mt-0" placeholder="×”×§×œ×“ ×©× ××•×¦×¨ (×œ××©×œ: ×¡×™×§×” ×˜×•×¤×¡×™×œ 107)...">
                <button onclick="runMagic()" class="bg-purple-600 text-white px-6 rounded-lg font-bold hover:bg-purple-700 whitespace-nowrap">×”×¤×¢×œ ×§×¡× âœ¨</button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm space-y-4">
            <h2 class="font-bold border-b pb-2">×¤×¨×˜×™ ××•×¦×¨</h2>
            <div><label class="text-xs text-gray-400">×©× ××•×¦×¨</label><input id="pName" class="input-std" oninput="updatePreview()"></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="text-xs text-gray-400">××•×ª×’</label><input id="pBrand" class="input-std" oninput="updatePreview()"></div>
                <div><label class="text-xs text-gray-400">×§×˜×’×•×¨×™×”</label>
                    <select id="pCat" class="input-std">
                        <option value="sealing">××™×˜×•×</option>
                        <option value="glues">×“×‘×§×™×</option>
                        <option value="flooring">×¨×™×¦×•×£</option>
                    </select>
                </div>
            </div>
            <div><label class="text-xs text-gray-400">×ª×™××•×¨ ×©×™×•×•×§×™</label><textarea id="pDesc" class="input-std h-24" oninput="updatePreview()"></textarea></div>
            <div><label class="text-xs text-gray-400">×ª××•× ×” (URL)</label><input id="pImg" class="input-std" oninput="updatePreview()"></div>
            
            <div class="bg-gray-50 p-4 rounded-xl border">
                <label class="text-xs font-bold text-gray-500 block mb-2">× ×ª×•× ×™× ×˜×›× ×™×™×</label>
                <div class="grid grid-cols-3 gap-2">
                    <input id="tCov" placeholder="×›×™×¡×•×™" class="input-std text-xs">
                    <input id="tDry" placeholder="×™×™×‘×•×©" class="input-std text-xs">
                    <input id="tThick" placeholder="×¢×•×‘×™" class="input-std text-xs">
                </div>
            </div>

            <button onclick="saveProduct()" class="w-full bg-[#E3000F] text-white py-4 rounded-xl font-bold text-lg hover:bg-red-600 shadow-lg">
                ×©××•×¨ ×•×¤×¨×¡× ×‘×§×™×•×¡×§ ğŸš€
            </button>
        </div>
    </div>

    <div class="w-1/2 flex items-center justify-center bg-gray-200 rounded-3xl relative">
        <div class="absolute top-4 right-4 bg-white px-3 py-1 rounded-full text-xs font-bold text-gray-500 shadow">×ª×¦×•×’×” ××§×“×™××”</div>
        
        <div class="preview-card group">
            <div class="h-1/2 bg-gray-50 flex items-center justify-center p-6 relative">
                <img id="prevImg" src="https://placehold.co/400?text=Product" class="max-h-full max-w-full object-contain mix-blend-multiply group-hover:scale-105 transition duration-500">
            </div>
            <div class="p-6 flex-1 flex flex-col bg-white">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2" id="prevBrand">BRAND</div>
                <h3 class="font-bold text-2xl leading-tight mb-3 text-gray-900" id="prevName">×©× ×”××•×¦×¨</h3>
                <p class="text-sm text-gray-500 line-clamp-3" id="prevDesc">×”×ª×™××•×¨ ×™×•×¤×™×¢ ×›××Ÿ...</p>
                <div class="mt-auto pt-4 border-t flex justify-between items-center text-[#E3000F] font-bold text-sm">
                    ×œ×¤×¨×˜×™× ××œ××™× <i data-lucide="arrow-left" size="16"></i>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { db } from '../js/firebase-config.js';
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { askGeminiAdmin } from '../js/gemini-service.js';

        lucide.createIcons();

        // Update Preview Realtime
        window.updatePreview = () => {
            document.getElementById('prevName').innerText = document.getElementById('pName').value || '×©× ×”××•×¦×¨';
            document.getElementById('prevBrand').innerText = document.getElementById('pBrand').value || 'BRAND';
            document.getElementById('prevDesc').innerText = document.getElementById('pDesc').value || '×ª×™××•×¨...';
            const imgUrl = document.getElementById('pImg').value;
            if(imgUrl) document.getElementById('prevImg').src = imgUrl;
        }

        // AI Magic
        window.runMagic = async () => {
            const name = document.getElementById('aiInput').value;
            if(!name) return alert("×× × ×”×§×œ×“ ×©× ××•×¦×¨");
            
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "×—×•×©×‘...";
            btn.disabled = true;

            const data = await askGeminiAdmin(name);
            
            if(data) {
                document.getElementById('pName').value = data.name || name;
                document.getElementById('pBrand').value = data.brand || '';
                document.getElementById('pDesc').value = data.marketingDesc || '';
                document.getElementById('pCat').value = data.category || 'sealing';
                
                if(data.tech) {
                    document.getElementById('tCov').value = data.tech.coverage || '';
                    document.getElementById('tDry').value = data.tech.drying || '';
                    document.getElementById('tThick').value = data.tech.thickness || '';
                }
                updatePreview();
            }
            btn.innerText = originalText;
            btn.disabled = false;
        }

        // Save
        window.saveProduct = async () => {
            const btn = event.target;
            btn.innerText = "×©×•××¨...";
            
            try {
                await addDoc(collection(db, "products"), {
                    name: document.getElementById('pName').value,
                    brand: document.getElementById('pBrand').value,
                    category: document.getElementById('pCat').value,
                    marketingDesc: document.getElementById('pDesc').value,
                    image: document.getElementById('pImg').value,
                    tech: {
                        coverage: document.getElementById('tCov').value,
                        drying: document.getElementById('tDry').value,
                        thickness: document.getElementById('tThick').value
                    },
                    createdAt: Date.now()
                });
                alert("××•×¦×¨ ×¢×œ×” ×œ××•×•×™×¨ ×‘×”×¦×œ×—×”! ğŸ”¥");
                location.reload();
            } catch (e) {
                alert("×©×’×™××”: " + e.message);
                btn.innerText = "× ×¡×” ×©×•×‘";
            }
        }
    </script>
</body>
</html>
